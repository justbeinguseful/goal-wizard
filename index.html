<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Goal Wizard + Stripe & Airtable</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* Basic layout & reset */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: sans-serif; background: transparent; }
    #wizard { max-width: 400px; margin: 20px auto; padding: 0 10px; }
    .step { display: none; }
    .step.active { display: block; }
    h2 { font-size: 1.5em; margin-bottom: 0.5em; text-align: center; }
    input, select { width: 100%; padding: 0.75em; font-size: 1em; margin-bottom: 1em; border: 1px solid #ccc; border-radius: 4px; }
    .checkbox-field { display: flex; align-items: center; margin-bottom: 1em; }
    .checkbox-field input { margin: 0; }
    .checkbox-field label { margin-left: 0.5em; font-size: 0.9em; }
    .buttons { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 1.5em; }
    button { flex: 1; padding: 0.75em; font-size: 1em; background: #e53e3e; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }
    #card-element { padding: 12px; border: 1px solid #ccc; border-radius: 4px; }
    #card-errors { color: red; margin-top: 0.5em; font-size: 0.9em; }
    @media (max-width: 480px) { #wizard { margin: 10px; } button { font-size: 0.9em; } }
  </style>
</head>
<body>
  <div id="wizard">
    <!-- Steps omitted for brevity, same as before -->
  </div>

  <script>
    // Your Netlify site origin
    const NETLIFY_ORIGIN = 'https://stately-sundae-b61659.netlify.app';

    // Replace relative calls with absolute URLs:
    async function createSetupIntent(payload) {
      return fetch(`${NETLIFY_ORIGIN}/.netlify/functions/create-setup-intent`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
    }
    async function writeToAirtable(payload) {
      return fetch(`${NETLIFY_ORIGIN}/.netlify/functions/submit-goal`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
    }

    // In your submit handler:
    document.getElementById('submitPayment').onclick = async () => {
      console.log('submitPayment clicked');
      const stakeValue = /* ... */;
      const payload = { /* ... collect fields ... */ };

      try {
        const siRes = await createSetupIntent(payload);
        if (!siRes.ok) throw new Error('SetupIntent failed');
        const { clientSecret } = await siRes.json();

        const result = await stripe.confirmCardSetup(clientSecret, { payment_method: { card } });
        if (result.error) throw result.error;

        const arRes = await writeToAirtable(payload);
        if (!arRes.ok) throw new Error('Airtable save failed');

        alert('âœ… All set!');
        showStep(1);
      } catch (err) {
        console.error(err);
        alert('Error: ' + err.message);
      }
    };

    // Rest of your initialization (watchRequired, navigation, etc.)
  </script>
</body>
</html>
